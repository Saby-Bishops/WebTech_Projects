<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Saniya's Recipe</title>
    <link rel="icon" type="image/png" href="./assets/images/icons/favicon.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="main.css" />
</head>
<body onload="loadHomeRecipes()">
    <section class="home-landing">
        <img src="./assets/images/icons/home-logo.png" alt="">
        <a href="" target="blank">
            <i class="icon-instagram"></i>
        </a>
    </section>
    <section class="home-recipe-section">
        <h1>All Recipes</h1>
        <div class="divider-line"></div>
        <div class="home-recipe-categories container" id="recipe-cats">
            <p class="active-recipe-cat" id="recipe-cat-all">All</p>
            <p id="recipe-cat-meat">Meat</p>
            <p id="recipe-cat-vegetarian">Vegetarian</p>
            <p id="recipe-cat-vegan">Vegan</p>
        </div>
        <div class="home-recipe-grid container">
            <div class="row">
            </div>
        </div>
    </section>
    <section class="home-add-on-section">
        <h1>Add-On Recipes</h1>
        <div class="divider-line"></div>
        <div class="home-add-on-grid container">
            <div class="row">
            </div>
        </div>
    </section>
    <section class="about-section" id="about">
        <div class="about-text">
            <h1>About Saniya</h1>
            <div class="divider-line"></div>
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Quidem dolore vitae enim praesentium magni, amet dignissimos laboriosam nesciunt maxime voluptatum eos vero veritatis voluptatem et consequatur officia reprehenderit ipsum mollitia animi repudiandae! Dicta a, nostrum cumque inventore odit delectus sequi. Nobis itaque molestiae dicta sed aliquam et optio voluptatum, quaerat pariatur nemo fuga quisquam cumque ipsum aut expedita ab possimus sit enim dolor dolorum incidunt quam est facilis adipisci? Nostrum expedita qui dolor reiciendis libero eum, quis doloremque quibusdam quas porro exercitationem fugit numquam quos error ipsa suscipit architecto ducimus dolore impedit provident voluptates consectetur. Modi officia illo quod, animi quisquam, dicta, optio adipisci dolores laboriosam fugiat ullam exercitationem! Esse hic amet minus animi iusto ratione dolorum aliquam libero distinctio ab sequi veritatis doloribus quos, et porro corporis officiis cupiditate suscipit at! Libero inventore fugiat numquam fugit voluptatem enim at dignissimos ea sint ullam, quos, earum doloribus, nesciunt provident assumenda ut. Ratione minima labore perferendis libero, quisquam neque amet eligendi quo non enim, nisi at tempora dolorum fugit, optio facilis voluptas ipsam magni debitis mollitia! Voluptate itaque tempore cumque molestias asperiores corporis ut commodi nemo sed molestiae, praesentium laudantium assumenda ducimus iure facere minus a libero quam unde perspiciatis architecto?</p>
        </div>
        <div class="about-image"></div>
    </section>
    <footer>
        <a href="" target="blank">
            <i class="icon-instagram"></i> Instagram
        </a>
        <p>Design & Development by <a href="#" target="blank">Saniya Pandita</a> </p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
    <script>
function openMenu()
 {
 if ($(".navbar-content").hasClass("navbar-open"))
 {
  $(".navbar-icon").toggleClass("change");
  $(".navbar-content").css("width", "0");
  $(".navbar-content").css("opacity", "0");
  $("body").css("overflow-y", "scroll");
  $(".navbar-content").toggleClass("navbar-open")
 }
else
{
  if ($(window).width() <= 768)
  {
    $(".navbar-content img").attr("src", "./assets/images/icons/navbar-logo.png")
    $(".navbar-content").css("width", "100vw");
    $(".navbar-content").css("opacity", "1");
  } else
  {
    $(".navbar-content").css("width", "60vw");
    $(".navbar-content").css("opacity", "1");
  }
  $(".navbar-icon").toggleClass("change");
  $("body").css("overflow-y", "hidden");
  $(".navbar-content").toggleClass("navbar-open");
 }
}
$(".home-recipe-categories > p").click(function ()
{
clickedCat = $(this).attr("id");
filterCat(clickedCat);
$(".home-recipe-categories > p").removeClass("active-recipe-cat");
$(this).addClass("active-recipe-cat");
});
function filterCat(recipeCat)
{
const category = recipeCat.slice(recipeCat.lastIndexOf("-") + 1, recipeCat.length);
console.log("filter: " + category)
if (category === "all")
 {
  $(".home-recipe-grid .home-recipe").fadeIn(500);
 } else
 {
  $(".home-recipe").hide();
  $(`.home-recipe[data-recipe-type="${category}"`).fadeIn(500);
 }
}
  </script>
  <script>
        //API CAll for recipies
  const api_url = "https://the-mish-dish-backend.herokuapp.com";
  const loadHomeRecipes = () => {
    axios.get(`${api_url}/recipes`)
        .then(response => {
            const recipes = response.data;
            recipes.forEach(recipe =>
              {
                let recipeThumbnail = recipe.thumbnail;
                recipeThumbnail = recipeThumbnail.replace("upload/", "upload/w_250/f_auto/");
                $(".home-recipe-grid .row").prepend(
                    `
                        <a class="home-recipe col-sm-6 col-lg-4 col-xl-3" id="${recipe.recipeCode}" href="./recipe.html#${recipe.recipeCode}" data-recipe-type="${recipe.diet}">
                            <img src=${recipeThumbnail}>
                            <h5>${recipe.name}</h5>
                        </a>
                        `
                )
            });
            hideLoader();
            windowLoadFilter()
        })
        .catch(err => console.log(err));
    if ($("home-add-on-grid .row").children().length < 1) {
        $(".home-add-on-section").hide()
    }
}
const loadRecipe = () => {
    let recipeCode = window.location.hash;
    if (recipeCode == "") {
        window.location.pathname = "/index.html"
    }
    recipeCode = recipeCode.substr(1);
    axios.get(`${api_url}/recipes/recipeCode/${recipeCode}`)
        .then(response => {
            const recipe = response.data;
            console.log(recipe)
            document.title = recipe.name;
            $('head').append(`<meta name="description" content="${recipe.description}">`);
            recipelandingImage = recipe.images[0].replace("upload/", "upload/f_auto/");
            $(".recipe-image").css("background-image", `url("${recipelandingImage}")`);
            $(".recipe-name").html(recipe.name);
            $(".recipe-description").html(recipe.description);
            $(".recipe-serving").html(recipe.servings);
            $(".recipe-cook").html(recipe.cookTime);
            const ingredientComponents = Object.keys(recipe.ingredients);
            if (ingredientComponents.length > 1) {
                let ingCount = 0;
                for (i = 0; i < ingredientComponents.length; i++) {
                    let key = ingredientComponents[i];
                    $(".ingredients-list").append(
                        `
                        <h2 class="ingredient-sub-heading"> ${key} </h2>
                        `
                    );
                    recipe.ingredients[key].forEach(ingredient => {
                        $(".ingredients-list").append(
                            `
                            <div>
                                <img src="./assets/images/icons/list-bullet.png">
                                <p> ${ingredient} </p>
                            </div>
                            `
                        )
                        ingCount++;
                    });
                }
                $(".recipe-ing-count").html(ingCount);
            } else {
                recipe.ingredients["0"].forEach(ingredient => {
                    $(".recipe-ing-count").html(recipe.ingredients["0"].length);
                    $(".ingredients-list").append(
                        `
                        <div>
                            <img src="./assets/images/icons/list-bullet.png">
                            <p> ${ingredient} </p>
                        </div>
                        `
                    )
                });
            }
           const methodComponents = Object.keys(recipe.method);
            if (methodComponents.length > 1) {
                for (i = 0; i < methodComponents.length; i++) {
                    let stepCount = 1;
                    let key = methodComponents[i];
                    $(".recipe-method-steps-list").append(
                        `
                        <h2 class="method-sub-heading"> ${key} </h2>
                        `
                    );
                    recipe.method[key].forEach(Method => {
                        $(".recipe-method-steps-list").append(
                            `
                            <div>
                                <p><span>${stepCount}</span> ${Method} </p>
                            </div>
                            `
                        )
                        stepCount++;
                    });
                }
            } else {
                let stepCount = 1;
                recipe.method["0"].forEach(Method => {
                    $(".recipe-method-steps-list").append(
                        `
                        <div>
                            <p><span>${stepCount}</span> ${Method} </p>
                        </div>
                        `
                    );
                    stepCount++;
                });
            }
            if (recipe.servingSuggestion == "") {
                $(".serving-suggestion").hide()
            } else {
                $(".recipe-serving-suggestion").html(recipe.servingSuggestion);
            }
            let imageCount = recipe.images.length;

            if (imageCount < 2) {
                $(".recipe-arrows").css("display", "none")
            }
            let imageClickCount = 1;

            $(".image-order").html(`${imageClickCount} / ${imageCount}`)

            $(".next-image").click(() => {
                imageClickCount++;
                if (imageClickCount > imageCount) {
                    imageClickCount = 1;
                }
                let recipeImage = `url("${recipe.images[imageClickCount - 1]}")`;
                $(".recipe-image").css("background-image", recipeImage);
                $(".image-order").html(`${imageClickCount} / ${imageCount}`)
            });
            $(".prev-image").click(() => {
                imageClickCount--;
                if (imageClickCount < imageCount) {
                    imageClickCount = 1;
                }
                let recipeImage = `url("${recipe.images[imageClickCount - 1]}")`;
                $(".recipe-image").css("background-image", recipeImage);
                $(".image-order").html(`${imageClickCount} / ${imageCount}`)
            });
            if (recipe.hasOwnProperty("addOnCode") && recipe.addOnCode != "") { // {Check if add-on recipe exists}

                $(".ingredients-list").append(
                    `<h2 class='ingredient-sub-heading'>${recipe.addOnName} </h2> \
                    <a href='./recipe.html#${recipe.addOnCode}' target="blank">Click here for the recipe</a>`
                );
            }
            hideLoader();
        })
        .catch(err => console.log(err))
}
const windowLoadFilter = () => {
    pageCat = window.location.href
    if (pageCat.indexOf("?") >= 0) {
        pageCat = pageCat.slice(pageCat.indexOf("?") + 1);

        filterCat(`recipe-${pageCat}`);
        $(".home-recipe-categories > p").removeClass("active-recipe-cat");
        $(`#recipe-cat-${pageCat}`).addClass("active-recipe-cat");
        document.querySelector('#recipe-cats').scrollIntoView({
            behavior: 'smooth'
        });
    }
}
    </script>
</body>
</html>
